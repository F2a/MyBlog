<!DOCTYPE html>
<html lang="">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="初识前端模块化">




  <meta name="keywords" content="架构设计,">





  <link rel="alternate" href="/default" title="银の龙の背に乗って">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1">



<link rel="canonical" href="https://f2a.github.io/blog/2018/10/01/architecture01/">


<meta name="description" content="整理自面谱 InterviewMap  1. ES6的模块功能有 Babel 的情况下，我们可以直接使用 ES6 的模块化。主要由两个命令构成：export和import。 export正确的写法1234// profile.jsexport var firstName = &amp;apos;Michael&amp;apos;;export var lastName = &amp;apos;Jackson&amp;apos;">
<meta name="keywords" content="架构设计">
<meta property="og:type" content="article">
<meta property="og:title" content="初识前端模块化">
<meta property="og:url" content="https://f2a.github.io/blog/2018/10/01/architecture01/index.html">
<meta property="og:site_name" content="银の龙の背に乗って">
<meta property="og:description" content="整理自面谱 InterviewMap  1. ES6的模块功能有 Babel 的情况下，我们可以直接使用 ES6 的模块化。主要由两个命令构成：export和import。 export正确的写法1234// profile.jsexport var firstName = &amp;apos;Michael&amp;apos;;export var lastName = &amp;apos;Jackson&amp;apos;">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2018-11-22T06:19:36.561Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="初识前端模块化">
<meta name="twitter:description" content="整理自面谱 InterviewMap  1. ES6的模块功能有 Babel 的情况下，我们可以直接使用 ES6 的模块化。主要由两个命令构成：export和import。 export正确的写法1234// profile.jsexport var firstName = &amp;apos;Michael&amp;apos;;export var lastName = &amp;apos;Jackson&amp;apos;">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> 初识前端模块化 - 银の龙の背に乗って </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">银の龙の背に乗って</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                归档
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                关于
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          初识前端模块化
        
      </h1>

      <time class="post-time">
          10月 01 2018
      </time>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ES6的模块功能"><span class="toc-text">1. ES6的模块功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#export"><span class="toc-text">export</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#正确的写法"><span class="toc-text">正确的写法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#错误的写法"><span class="toc-text">错误的写法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#export-default"><span class="toc-text">export default</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#重命名-as"><span class="toc-text">重命名 as</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#import"><span class="toc-text">import</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#正确的写法-1"><span class="toc-text">正确的写法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#错误的写法-1"><span class="toc-text">错误的写法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#整体加载"><span class="toc-text">整体加载</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#动态加载"><span class="toc-text">动态加载</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#重命名-as-1"><span class="toc-text">重命名 as</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-CommonJS"><span class="toc-text">2. CommonJS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-AMD"><span class="toc-text">3. AMD</span></a></li></ol>
    </div>
  </div>


    
            <div class="post-content">
            <blockquote>
<p>整理自面谱 InterviewMap</p>
</blockquote>
<h3 id="1-ES6的模块功能"><a href="#1-ES6的模块功能" class="headerlink" title="1. ES6的模块功能"></a>1. ES6的模块功能</h3><p>有 Babel 的情况下，我们可以直接使用 ES6 的模块化。<br>主要由两个命令构成：export和import。</p>
<h4 id="export"><a href="#export" class="headerlink" title="export"></a>export</h4><h5 id="正确的写法"><a href="#正确的写法" class="headerlink" title="正确的写法"></a>正确的写法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// profile.js</span><br><span class="line">export var firstName = &apos;Michael&apos;;</span><br><span class="line">export var lastName = &apos;Jackson&apos;;</span><br><span class="line">export var year = 1958;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// profile.js</span><br><span class="line">var firstName = &apos;Michael&apos;;</span><br><span class="line">var lastName = &apos;Jackson&apos;;</span><br><span class="line">var year = 1958;</span><br><span class="line"></span><br><span class="line">export &#123;firstName, lastName, year&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export function multiply(x, y) &#123;</span><br><span class="line">  return x * y;</span><br><span class="line">&#125;;</span><br><span class="line">// 对外输出一个函数multiply。</span><br></pre></td></tr></table></figure>
<h5 id="错误的写法"><a href="#错误的写法" class="headerlink" title="错误的写法"></a>错误的写法</h5><p>export命令规定的是对外的接口，必须与模块内部的变量建立一一对应关系。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// 报错</span><br><span class="line">export 1;</span><br><span class="line"></span><br><span class="line">// 报错</span><br><span class="line">var m = 1;</span><br><span class="line">export m;</span><br><span class="line"></span><br><span class="line">// 没有提供对外的接口。第一种写法直接输出 1，第二种写法通过变量m，还是直接输出 1。1只是一个值，不是接口。正确的写法是下面这样。</span><br><span class="line"></span><br><span class="line">// 写法一</span><br><span class="line">export var m = 1;</span><br><span class="line"></span><br><span class="line">// 写法二</span><br><span class="line">var m = 1;</span><br><span class="line">export &#123;m&#125;;</span><br><span class="line"></span><br><span class="line">// 写法三</span><br><span class="line">var n = 1;</span><br><span class="line">export &#123;n as m&#125;;</span><br><span class="line"></span><br><span class="line">// function和class的输出，也必须遵守这样的写法。</span><br><span class="line"></span><br><span class="line">// 报错</span><br><span class="line">function f() &#123;&#125;</span><br><span class="line">export f;</span><br><span class="line"></span><br><span class="line">// 正确</span><br><span class="line">export function f() &#123;&#125;;</span><br><span class="line"></span><br><span class="line">// 正确</span><br><span class="line">function f() &#123;&#125;</span><br><span class="line">export &#123;f&#125;;</span><br></pre></td></tr></table></figure>
<p>export命令可以出现在模块的任何位置，只要处于模块顶层就可以。如果处于块级作用域内，就会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">  export default &apos;bar&apos; // SyntaxError 报错</span><br><span class="line">&#125;</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<p>export语句输出的接口，与其对应的值是动态绑定关系，即通过该接口，可以取到模块内部实时的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export var foo = &apos;bar&apos;;</span><br><span class="line">setTimeout(() =&gt; foo = &apos;baz&apos;, 500);</span><br><span class="line">// 上面代码输出变量foo，值为bar，500 毫秒之后变成baz。</span><br></pre></td></tr></table></figure>
<h5 id="export-default"><a href="#export-default" class="headerlink" title="export default"></a>export default</h5><ol>
<li>为了给用户提供方便，让他们不用阅读文档就能加载模块，就要用到export default命令，为模块指定默认输出。</li>
<li>一个模块只能有一个默认输出，因此export default命令只能使用一次。</li>
<li>export default也可以用来输出类。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// export-default.js</span><br><span class="line">export default function () &#123;</span><br><span class="line">  console.log(&apos;foo&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 或者写成</span><br><span class="line">function foo() &#123;</span><br><span class="line">  console.log(&apos;foo&apos;);</span><br><span class="line">&#125;</span><br><span class="line">export default foo;</span><br><span class="line"></span><br><span class="line">// 上面代码是一个模块文件export-default.js，它的默认输出是一个函数。</span><br><span class="line">// 其他模块加载该模块时，import命令可以为该匿名函数指定任意名字。</span><br><span class="line"></span><br><span class="line">// import-default.js</span><br><span class="line">import customName from &apos;./export-default&apos;;</span><br><span class="line">customName(); // &apos;foo&apos;</span><br><span class="line">// 注意的是，这时import命令后面，不使用大括号。</span><br></pre></td></tr></table></figure>
<p>下面的写法是有效的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// modules.js</span><br><span class="line">function add(x, y) &#123;</span><br><span class="line">  return x * y;</span><br><span class="line">&#125;</span><br><span class="line">export &#123;add as default&#125;;</span><br><span class="line">// 等同于</span><br><span class="line">// export default add;</span><br><span class="line"></span><br><span class="line">// app.js</span><br><span class="line">import &#123; default as foo &#125; from &apos;modules&apos;;</span><br><span class="line">// 等同于</span><br><span class="line">// import foo from &apos;modules&apos;;</span><br><span class="line"></span><br><span class="line">// 如果想在一条import语句中，同时输入默认方法和其他接口，可以写成下面这样。</span><br><span class="line">import _, &#123; each, forEach &#125; from &apos;lodash&apos;;</span><br></pre></td></tr></table></figure>
<h5 id="重命名-as"><a href="#重命名-as" class="headerlink" title="重命名 as"></a>重命名 as</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function v1() &#123; ... &#125;</span><br><span class="line">function v2() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">export &#123;</span><br><span class="line">  v1 as streamV1,</span><br><span class="line">  v2 as streamV2,</span><br><span class="line">  v2 as streamLatestVersion</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="import"><a href="#import" class="headerlink" title="import"></a>import</h4><p>使用export命令定义了模块的对外接口以后，其他 JS 文件就可以通过import命令加载这个模块。</p>
<h5 id="正确的写法-1"><a href="#正确的写法-1" class="headerlink" title="正确的写法"></a>正确的写法</h5><p>import命令接受一对大括号，里面指定要从其他模块导入的变量名。大括号里面的变量名，必须与被导入模块（profile.js）对外接口的名称相同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// main.js</span><br><span class="line">import &#123;firstName, lastName, year&#125; from &apos;./profile.js&apos;;</span><br><span class="line"></span><br><span class="line">function setName(element) &#123;</span><br><span class="line">  element.textContent = firstName + &apos; &apos; + lastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>import后面的from指定模块文件的位置，可以是相对路径，也可以是绝对路径，.js后缀可以省略。如果只是模块名，不带有路径，那么必须有配置文件，告诉 JavaScript 引擎该模块的位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123;myMethod&#125; from &apos;util&apos;;</span><br></pre></td></tr></table></figure>
<p>import命令具有提升效果，会提升到整个模块的头部。import命令是编译阶段执行的，在代码运行之前。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foo();</span><br><span class="line"></span><br><span class="line">import &#123; foo &#125; from &apos;my_module&apos;;</span><br></pre></td></tr></table></figure>
<p>import语句会执行所加载的模块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 仅仅执行lodash模块，但是不输入任何值。</span><br><span class="line">import &apos;lodash&apos;;</span><br><span class="line"></span><br><span class="line">// 下面代码加载了两次lodash，但是只会执行一次。</span><br><span class="line">import &apos;lodash&apos;;</span><br><span class="line">import &apos;lodash&apos;;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; foo &#125; from &apos;my_module&apos;;</span><br><span class="line">import &#123; bar &#125; from &apos;my_module&apos;;</span><br><span class="line"></span><br><span class="line">// 等同于</span><br><span class="line">import &#123; foo, bar &#125; from &apos;my_module&apos;;</span><br></pre></td></tr></table></figure>
<h5 id="错误的写法-1"><a href="#错误的写法-1" class="headerlink" title="错误的写法"></a>错误的写法</h5><p>import是静态执行，所以不能使用表达式和变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 报错</span><br><span class="line">import &#123; &apos;f&apos; + &apos;oo&apos; &#125; from &apos;my_module&apos;;</span><br><span class="line"></span><br><span class="line">// 报错</span><br><span class="line">let module = &apos;my_module&apos;;</span><br><span class="line">import &#123; foo &#125; from module;</span><br><span class="line"></span><br><span class="line">// 报错</span><br><span class="line">if (x === 1) &#123;</span><br><span class="line">  import &#123; foo &#125; from &apos;module1&apos;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  import &#123; foo &#125; from &apos;module2&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>import命令输入的变量都是只读的，因为它的本质是输入接口。也就是说，不允许在加载模块的脚本里面，改写接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123;a&#125; from &apos;./xxx.js&apos;</span><br><span class="line"></span><br><span class="line">a = &#123;&#125;; // Syntax Error : &apos;a&apos; is read-only;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123;a&#125; from &apos;./xxx.js&apos;</span><br><span class="line"></span><br><span class="line">a.foo = &apos;hello&apos;; // 合法操作</span><br><span class="line"></span><br><span class="line">//a的属性可以成功改写，并且其他模块也可以读到改写后的值。不过，这种写法很难查错，建议凡是输入的变量，都当作完全只读，轻易不要改变它的属性。</span><br></pre></td></tr></table></figure>
<h5 id="整体加载"><a href="#整体加载" class="headerlink" title="整体加载"></a>整体加载</h5><p>用星号（*）指定一个对象，所有输出值都加载在这个对象上面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// circle.js</span><br><span class="line"></span><br><span class="line">export function area(radius) &#123;</span><br><span class="line">  return Math.PI * radius * radius;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function circumference(radius) &#123;</span><br><span class="line">  return 2 * Math.PI * radius;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; area, circumference &#125; from &apos;./circle&apos;;</span><br><span class="line">console.log(&apos;圆面积：&apos; + area(4));</span><br><span class="line">console.log(&apos;圆周长：&apos; + circumference(14));</span><br><span class="line">// 同等于</span><br><span class="line">import * as circle from &apos;./circle&apos;;</span><br><span class="line">console.log(&apos;圆面积：&apos; + circle.area(4));</span><br><span class="line">console.log(&apos;圆周长：&apos; + circle.circumference(14));</span><br></pre></td></tr></table></figure>
<p>模块整体加载所在的那个对象（上例是circle），应该是可以静态分析的，所以不允许运行时改变</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import * as circle from &apos;./circle&apos;;</span><br><span class="line"></span><br><span class="line">// 下面两行都是不允许的</span><br><span class="line">circle.foo = &apos;hello&apos;;</span><br><span class="line">circle.area = function () &#123;&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="动态加载"><a href="#动态加载" class="headerlink" title="动态加载"></a>动态加载</h5><p>import和export命令只能在模块的顶层</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 报错</span><br><span class="line">if (x === 2) &#123;</span><br><span class="line">  import MyModual from &apos;./myModual&apos;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 引擎处理import语句是在编译时，这时不会去分析或执行if语句，所以import语句放在if代码块之中毫无意义，因此会报句法错误，而不是执行时错误</span><br></pre></td></tr></table></figure>
<p>因此，有一个提案，建议引入import()函数，完成动态加载。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const main = document.querySelector(&apos;main&apos;);</span><br><span class="line"></span><br><span class="line">import(`./section-modules/$&#123;someVariable&#125;.js`)</span><br><span class="line">  .then(module =&gt; &#123;</span><br><span class="line">    module.loadPageInto(main);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(err =&gt; &#123;</span><br><span class="line">    main.textContent = err.message;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>import()函数可以用在任何地方，不仅仅是模块，非模块的脚本也可以使用。它是运行时执行，也就是说，什么时候运行到这一句，就会加载指定的模块。另外，import()函数与所加载的模块没有静态连接关系，这点也是与import语句不相同。import()类似于 Node 的require方法，区别主要是前者是异步加载，后者是同步加载。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 按需加载。</span><br><span class="line">button.addEventListener(&apos;click&apos;, event =&gt; &#123;</span><br><span class="line">  import(&apos;./dialogBox.js&apos;)</span><br><span class="line">  .then(dialogBox =&gt; &#123;</span><br><span class="line">    dialogBox.open();</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(error =&gt; &#123;</span><br><span class="line">    /* Error handling */</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 条件加载。</span><br><span class="line">if (condition) &#123;</span><br><span class="line">  import(&apos;moduleA&apos;).then(...);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  import(&apos;moduleB&apos;).then(...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 动态的模块路径</span><br><span class="line">// import()允许模块路径动态生成。</span><br><span class="line">import(f())</span><br><span class="line">.then(...);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// default输出接口，可以用参数直接获得。</span><br><span class="line">import(&apos;./myModule.js&apos;)</span><br><span class="line">.then(myModule =&gt; &#123;</span><br><span class="line">  console.log(myModule.default);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 上面的代码也可以使用具名输入的形式。</span><br><span class="line">import(&apos;./myModule.js&apos;)</span><br><span class="line">.then((&#123;default: theDefault&#125;) =&gt; &#123;</span><br><span class="line">  console.log(theDefault);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 如果想同时加载多个模块，可以采用下面的写法。</span><br><span class="line">Promise.all([</span><br><span class="line">  import(&apos;./module1.js&apos;),</span><br><span class="line">  import(&apos;./module2.js&apos;),</span><br><span class="line">  import(&apos;./module3.js&apos;),</span><br><span class="line">])</span><br><span class="line">.then(([module1, module2, module3]) =&gt; &#123;</span><br><span class="line">   ···</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// import()也可以用在 async 函数之中。</span><br></pre></td></tr></table></figure>
<h5 id="重命名-as-1"><a href="#重命名-as-1" class="headerlink" title="重命名 as"></a>重命名 as</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; lastName as surname &#125; from &apos;./profile.js&apos;;</span><br></pre></td></tr></table></figure>
<h3 id="2-CommonJS"><a href="#2-CommonJS" class="headerlink" title="2. CommonJS"></a>2. CommonJS</h3><p>CommonJs 是 Node 独有的规范，浏览器中使用就需要用到 Browserify 解析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// a.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    a: 1</span><br><span class="line">&#125;</span><br><span class="line">// or</span><br><span class="line">exports.a = 1</span><br><span class="line"></span><br><span class="line">// b.js</span><br><span class="line">var module = require(&apos;./a.js&apos;)</span><br><span class="line">module.a // -&gt; log 1</span><br></pre></td></tr></table></figure>
<p>来说说 module.exports 和 exports，用法其实是相似的，但是不能对 exports 直接赋值，不会有任何效果。</p>
<p>对于 CommonJS 和 ES6 中的模块化的两者区别是：</p>
<ul>
<li>前者支持动态导入，也就是 require(${path}/xx.js)，后者目前不支持，但是已有提案 import()</li>
<li>前者是同步导入，因为用于服务端，文件都在本地，同步导入即使卡住主线程影响也不大。而后者是异步导入，因为用于浏览器，需要下载文件，如果也采用同步导入会对渲染有很大影响</li>
<li>前者在导出时都是值拷贝，就算导出的值变了，导入的值也不会改变，所以如果想更新值，必须重新导入一次。但是后者采用实时绑定的方式，导入导出的值都指向同一个内存地址，所以导入值会跟随导出值变化</li>
<li>后者会编译成 require/exports 来执行的</li>
</ul>
<h3 id="3-AMD"><a href="#3-AMD" class="headerlink" title="3. AMD"></a>3. AMD</h3><p>AMD 是由 RequireJS 提出的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// AMD</span><br><span class="line">define([&apos;./a&apos;, &apos;./b&apos;], function(a, b) &#123;</span><br><span class="line">    a.do()</span><br><span class="line">    b.do()</span><br><span class="line">&#125;)</span><br><span class="line">define(function(require, exports, module) &#123;</span><br><span class="line">    var a = require(&apos;./a&apos;)</span><br><span class="line">    a.doSomething()</span><br><span class="line">    var b = require(&apos;./b&apos;)</span><br><span class="line">    b.doSomething()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/架构设计/">架构设计</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018/11/21/vue01/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Vue 3.0 新特性预览</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2018/09/11/browser02/">
        <span class="next-text nav-default">优化项目，增强体验（二）</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2017 -
    
    2018
    <span class="footer-author">FangR.</span>
    <span class="power-by">
        由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a> 强力驱动
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
